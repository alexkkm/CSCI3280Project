{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\OneDrive\\\\\\u6587\\u4EF6\\\\GitHub\\\\CSCI3280Project\\\\client\\\\src\\\\AudioScript\\\\AudioPlayer.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { DecodeWav } from './WavDecoder';\nimport MusicVisualizer from './MusicVisualizer';\nimport LrcDisplayer from './LrcDisplayer';\nimport musicList from '../MusicDatabase/musicList';\nimport Client from './Client';\nimport io from 'socket.io-client';\nimport \"../index.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function AudioPlayer() {\n  _s();\n  const numberToTime = number => {\n    const minutes = Math.floor(number / 60);\n    const seconds = Math.floor(number % 60);\n    const minutesString = minutes < 10 ? `0${minutes}` : `${minutes}`;\n    const secondsString = seconds < 10 ? `0${seconds}` : `${seconds}`;\n    return `${minutesString}:${secondsString}`;\n  };\n  const socket = io.connect(\"http://localhost:3001\");\n  const [fileName, setFileName] = useState(null);\n  // const [audioURL, setAudioURL] = useState(null);\n  const [audioBuffer, setAudioBuffer] = useState(null);\n  const [audioData, setAudioData] = useState(null); // wav audio data\n  const [audioSource, setAudioSource] = useState(null); // the audio\n  const [isPlayingMusic, setIsPlayingMusic] = useState(false); // is music paying\n  const [volumeLevel, setVolumeLevel] = useState(0.5); // music volume level\n  const [audioContext, setAudioContext] = useState(null); // holder of the audio and properties\n  const [analyser, setAnalyser] = useState(null); // for music visualizer\n  const [musicFormat, setMusicFormat] = useState(null); // music format: wav, mp3, null\n  const [currentTime, setCurrentTime] = useState(0); // for progress bar\n  const [duration, setDuration] = useState(0); // for progress bar\n  const [currentMusic, setCurrentMusic] = useState(null); // for database and lyric\n  const [playMode, setPlayMode] = useState('single'); // for play mode, single, loop, random\n  const [searchKeywords, setSearch] = useState('');\n  const handleSearchChange = event => {\n    setSearch(event.target.value);\n  };\n  const [title, setTitle] = useState('unknown'); // for title\n  const handleTitleChange = event => {\n    setTitle(event.target.value);\n  };\n  const [artist, setArtist] = useState('unknown'); // for artist\n  const handleArtistChange = event => {\n    setArtist(event.target.value);\n  };\n  const [album, setAlbum] = useState('unknown'); // for album\n  const handleAlbumChange = event => {\n    setAlbum(event.target.value);\n  };\n  const [coverFile, setCoverFile] = useState(null); // for cover\n  const handleCoverFileChange = event => {\n    const file = event.target.files[0];\n    const format = file.name.substr(file.name.length - 3);\n    if (format !== 'jpg' && format !== 'JPG' && format !== 'png' && format !== 'PNG') {\n      if (file.name.substr(file.name.length - 4) !== 'jpeg' && file.name.substr(file.name.length - 4) !== 'JPEG') {\n        alert('Please upload a jpg or png file');\n        return;\n      }\n    }\n    const fpath = URL.createObjectURL(file);\n    setCoverFile(fpath);\n  };\n  const [lyricsFile, setLyricsFile] = useState(null); // for lyrics\n  const handleLyricsFileChange = event => {\n    const file = event.target.files[0];\n    const format = file.name.substr(file.name.length - 3);\n    if (format !== 'txt' && format !== 'lrc') {\n      alert('Please upload a txt or lrc file');\n      return;\n    }\n    var fpath = URL.createObjectURL(file);\n    fpath = fpath.concat(\".\" + format);\n    setLyricsFile(fpath);\n  };\n  const [musicFile, setMusicFile] = useState(null); // for music file\n  const handleMusicFileChange = event => {\n    const file = event.target.files[0];\n    const format = file.name.substr(file.name.length - 3);\n    if (format !== 'wav' && format !== 'mp3' && format !== 'ogg' && 'aac') {\n      alert('Please upload a wav, mp3, ogg or aac file');\n      return;\n    }\n    const fpath = URL.createObjectURL(file);\n    setMusicFile(fpath);\n  };\n  const [, updateState] = React.useState();\n  const forceUpdate = React.useCallback(() => updateState({}), []); // force rerender\n\n  // Add music to database\n  const addMusic = useCallback(() => {\n    if (musicFile === null) {\n      alert(\"please upload a music\");\n      return;\n    }\n    if (title === null) {\n      setTitle('unknown');\n    }\n    if (artist === null) {\n      setArtist('unknown');\n    }\n    if (album === null) {\n      setAlbum('unknown');\n    }\n    if (coverFile === null) {\n      setCoverFile('');\n    }\n    if (lyricsFile === null) {\n      setLyricsFile('');\n    }\n    if (musicFile === null) {\n      setMusicFile('');\n    }\n    musicList.push({\n      \"audioPath\": musicFile,\n      \"audioTitle\": title,\n      \"artist\": artist,\n      \"album\": album,\n      \"coverPhotoPath\": coverFile,\n      \"lyricsPath\": lyricsFile\n    });\n    forceUpdate();\n    setTitle('unknown');\n    setArtist('unknown');\n    setAlbum('unknown');\n    setCoverFile(null);\n    setLyricsFile(null);\n    setMusicFile(null);\n  }, [forceUpdate, title, artist, album, coverFile, lyricsFile, musicFile]);\n\n  // delete music from database\n  const deleteMusic = useCallback(name => {\n    musicList.splice(musicList.findIndex(obj => obj.audioTitle === name), 1);\n    forceUpdate();\n  }, [forceUpdate]);\n\n  // Load music from database\n  const loadMusic = async audioTitle => {\n    // Find the object in the JSON data that contains the audioTitle\n    const audioObj = musicList.find(obj => obj.audioTitle === audioTitle);\n    if (!audioObj) {\n      alert(`Audio file not found for title: ${audioTitle}`);\n      return;\n    }\n\n    // Create a new File object from the audio path in the object\n    const file = new File([await fetch(audioObj.audioPath).then(response => response.blob())], audioObj.audioPath);\n    setCurrentMusic(audioObj);\n    handleStopClick();\n    setFileName(file.name);\n    const format = file.name.substr(file.name.length - 3);\n    setAudioData(null);\n    // setAudioURL(URL.createObjectURL(file));\n    const newAudioContext = new AudioContext();\n    switch (format.toLowerCase()) {\n      case 'wav':\n        setMusicFormat('wav');\n        const decodedData = await DecodeWav(file);\n        setAudioData(decodedData);\n        setAudioBuffer(newAudioContext.createBuffer(decodedData.numChannels, decodedData.audioData.length / decodedData.numChannels, decodedData.sampleRate));\n        setDuration(decodedData.duration);\n        break;\n      default:\n        setMusicFormat(format.toLowerCase());\n        const response = await fetch(URL.createObjectURL(file));\n        const arrayBuffer = await response.arrayBuffer();\n        const decodedAudioData = await newAudioContext.decodeAudioData(arrayBuffer);\n        setAudioData(decodedAudioData);\n        setAudioBuffer(decodedAudioData);\n        setDuration(decodedAudioData.duration);\n        break;\n    }\n    if (audioSource !== null) {\n      audioSource.stop();\n    }\n    newAudioContext.close();\n  };\n  const handleFileChange = async event => {\n    const file = event.target.files[0];\n    const format = file.name.substr(file.name.length - 3);\n    if (format !== 'wav' && format !== 'mp3' && format !== 'ogg' && 'aac') {\n      alert('Please upload a wav, mp3, ogg or aac file');\n      return;\n    }\n    var isMusicExist = false;\n    musicList.map(music => {\n      if (music.audioTitle === file.name.substr(0, file.name.length - 4)) {\n        isMusicExist = true;\n        alert('This music is already in the database');\n      }\n    });\n    const fpath = URL.createObjectURL(file);\n    setMusicFile(fpath);\n  };\n\n  // Play Music\n  const handlePlayClick = () => {\n    if (isPlayingMusic === true) return;\n    if (musicFormat === null) return;\n    console.log('play');\n    setIsPlayingMusic(true);\n    if (audioSource !== null && audioSource.context.state === 'suspended') {\n      // resume audio\n      audioSource.context.resume();\n    } else {\n      // play a new audio\n      setCurrentTime(0);\n      setOffset(0);\n      let newAudioContext;\n      if (audioContext === null) newAudioContext = new AudioContext();else newAudioContext = audioContext;\n\n      // set analyser\n      const analyser = newAudioContext.createAnalyser();\n      analyser.fftSize = 256;\n      analyser.connect(newAudioContext.destination);\n      setAnalyser(analyser);\n\n      // set volume\n      const gainNode = newAudioContext.createGain();\n      gainNode.gain.value = volumeLevel;\n      gainNode.connect(analyser);\n      if (musicFormat === 'wav') {\n        for (let channel = 0; channel < audioData.numChannels; channel++) {\n          const channelData = audioBuffer.getChannelData(channel);\n          for (let i = 0; i < audioData.audioData.length; i += audioData.numChannels) {\n            channelData[i / audioData.numChannels] = audioData.audioData[i + channel];\n          }\n        }\n      }\n      const sourceNode = newAudioContext.createBufferSource();\n      sourceNode.buffer = audioBuffer;\n      sourceNode.connect(gainNode);\n      sourceNode.start();\n      setAudioSource(sourceNode);\n      setAudioContext(newAudioContext);\n    }\n  };\n\n  // Pause Music\n  const handlePauseClick = () => {\n    setIsPlayingMusic(false);\n    if (audioSource !== null && audioSource.context.state === 'running') {\n      audioSource.context.suspend();\n    }\n  };\n\n  // Stop Music\n  const handleStopClick = () => {\n    setIsPlayingMusic(false);\n    if (audioSource !== null) {\n      audioSource.stop();\n      setAudioSource(null);\n    }\n    if (audioContext !== null) {\n      audioContext.close();\n      setAudioContext(null);\n    }\n    setOffset(0);\n    document.getElementById('progressBar').value = 0;\n    setCurrentTime(0);\n  };\n\n  // Volume Control\n  const handleVolumeChange = event => {\n    setVolumeLevel(parseFloat(event.target.value));\n    if (audioSource !== null) {\n      const gainNode = audioContext.createGain();\n      // console.log('volumeLevel: ', volumeLevel);\n      gainNode.gain.value = volumeLevel;\n      gainNode.connect(analyser);\n      audioSource.disconnect();\n      audioSource.connect(gainNode);\n    }\n  };\n\n  // Progress Bar\n  const [offset, setOffset] = useState(0);\n  const setProgressBar = () => {\n    if (audioSource === null) return;\n    const progressBar = document.getElementById('progressBar');\n    let targetTime = progressBar.value;\n    setOffset(targetTime);\n    if (audioSource !== null) {\n      audioSource.stop();\n      setAudioSource(null);\n    }\n    let newAudioContext;\n    if (audioContext !== null) {\n      audioContext.close();\n      setAudioContext(null);\n      newAudioContext = new AudioContext();\n    } else newAudioContext = audioContext;\n\n    // set analyser\n    const analyser = newAudioContext.createAnalyser();\n    analyser.fftSize = 256;\n    analyser.connect(newAudioContext.destination);\n    setAnalyser(analyser);\n\n    // set volume\n    const gainNode = newAudioContext.createGain();\n    gainNode.gain.value = volumeLevel;\n    gainNode.connect(analyser);\n    if (musicFormat === 'wav') for (let channel = 0; channel < audioData.numChannels; channel++) {\n      const channelData = audioBuffer.getChannelData(channel);\n      for (let i = 0; i < audioData.audioData.length; i += audioData.numChannels) {\n        channelData[i / audioData.numChannels] = audioData.audioData[i + channel];\n      }\n    }\n    const sourceNode = newAudioContext.createBufferSource();\n    sourceNode.buffer = audioBuffer;\n    sourceNode.connect(gainNode);\n    sourceNode.start(0, targetTime);\n    setAudioSource(sourceNode);\n    setAudioContext(newAudioContext);\n    if (!isPlayingMusic) {\n      sourceNode.context.suspend();\n    }\n    updateProgressBar();\n  };\n  const updateProgressBar = useCallback(() => {\n    const progressBar = document.getElementById('progressBar');\n    let duration = audioData ? audioData.duration : 0;\n    let time = audioContext.currentTime - audioSource.context.baseLatency + parseFloat(offset);\n    if (time > duration) {\n      time = duration;\n    }\n    progressBar.value = time;\n    setCurrentTime(time);\n  }, [audioContext, audioData, audioSource, offset]);\n  useEffect(() => {\n    if (isPlayingMusic) {\n      const interval = setInterval(updateProgressBar, 10);\n      return () => clearInterval(interval);\n    }\n  }, [isPlayingMusic, updateProgressBar]);\n\n  // Load and Play\n  const loadAndPlayMusic = async audioTitle => {\n    // Find the object in the JSON data that contains the audioTitle\n    const audioObj = musicList.find(obj => obj.audioTitle === audioTitle);\n    if (!audioObj) {\n      alert(`Audio file not found for title: ${audioTitle}`);\n      return;\n    }\n\n    // Create a new File object from the audio path in the object\n    const file = new File([await fetch(audioObj.audioPath).then(response => response.blob())], audioObj.audioPath);\n    setCurrentMusic(audioObj);\n    if (audioSource !== null) {\n      audioSource.stop();\n      setAudioSource(null);\n    }\n    if (audioContext !== null) {\n      audioContext.close();\n      setAudioContext(null);\n    }\n    setOffset(0);\n    document.getElementById('progressBar').value = 0;\n    setCurrentTime(0);\n    setFileName(file.name);\n    const format = file.name.substr(file.name.length - 3);\n    let decodedAudioData;\n    let decodedAudioBuffer;\n    setAudioData(null);\n    // setAudioURL(URL.createObjectURL(file));\n    const new2AudioContext = new AudioContext();\n    switch (format.toLowerCase()) {\n      case 'wav':\n        setMusicFormat('wav');\n        decodedAudioData = await DecodeWav(file);\n        setAudioData(decodedAudioData);\n        decodedAudioBuffer = new2AudioContext.createBuffer(decodedAudioData.numChannels, decodedAudioData.audioData.length / decodedAudioData.numChannels, decodedAudioData.sampleRate);\n        setAudioBuffer(decodedAudioBuffer);\n        setDuration(decodedAudioData.duration);\n        break;\n      default:\n        setMusicFormat(format.toLowerCase());\n        const response = await fetch(URL.createObjectURL(file));\n        const arrayBuffer = await response.arrayBuffer();\n        decodedAudioData = await new2AudioContext.decodeAudioData(arrayBuffer);\n        setAudioData(decodedAudioData);\n        decodedAudioBuffer = decodedAudioData;\n        setAudioBuffer(decodedAudioBuffer);\n        setDuration(decodedAudioData.duration);\n        break;\n    }\n    if (audioSource !== null) {\n      audioSource.stop();\n    }\n    new2AudioContext.close();\n    setIsPlayingMusic(true);\n\n    // play a new audio\n    setCurrentTime(0);\n    setOffset(0);\n    let new3AudioContext;\n    if (audioContext === null || audioContext.state === \"closed\") new3AudioContext = new AudioContext();else new3AudioContext = audioContext;\n\n    // set analyser\n    const analyser = new3AudioContext.createAnalyser();\n    analyser.fftSize = 256;\n    analyser.connect(new3AudioContext.destination);\n    setAnalyser(analyser);\n\n    // set volume\n    const gainNode = new3AudioContext.createGain();\n    gainNode.gain.value = volumeLevel;\n    gainNode.connect(analyser);\n    if (musicFormat === 'wav') {\n      for (let channel = 0; channel < decodedAudioData.numChannels; channel++) {\n        const channelData = decodedAudioBuffer.getChannelData(channel);\n        for (let i = 0; i < decodedAudioData.decodedAudioData.length; i += decodedAudioData.numChannels) {\n          channelData[i / decodedAudioData.numChannels] = decodedAudioData.decodedAudioData[i + channel];\n        }\n      }\n    }\n    const sourceNode = new3AudioContext.createBufferSource();\n    sourceNode.buffer = decodedAudioBuffer;\n    sourceNode.connect(gainNode);\n    sourceNode.start();\n    setAudioSource(sourceNode);\n    setAudioContext(new3AudioContext);\n  };\n\n  // handle PlayMode\n  useEffect(() => {\n    if (audioContext === null) return;\n    const handleEnd = () => {\n      setIsPlayingMusic(false);\n      setCurrentTime(0);\n      switch (playMode) {\n        case 'single':\n          audioSource.stop();\n          break;\n        case 'loop':\n          loadAndPlayMusic(currentMusic.audioTitle);\n          break;\n        case 'random':\n          const randomIndex = Math.floor(Math.random() * musicList.length);\n          const randomMusic = musicList[randomIndex];\n          loadAndPlayMusic(randomMusic.audioTitle);\n          break;\n        default:\n          break;\n      }\n    };\n    audioSource.addEventListener('ended', handleEnd);\n    return () => audioSource.removeEventListener('ended', handleEnd);\n  }, [audioContext, audioData, audioSource, currentMusic, musicFormat, playMode, volumeLevel]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"audioPlayer\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row align-items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"section\", {\n          className: \" col-lg-7 col-md-12 p-1 p-lg-5\",\n          id: \"topLeft\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-flex flex-column align-items-center\",\n            children: [/*#__PURE__*/_jsxDEV(MusicVisualizer, {\n              class: \"mx-auto d-block\",\n              audioContext: audioContext,\n              analyser: analyser,\n              width: 450,\n              height: 50\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 470,\n              columnNumber: 29\n            }, this), currentMusic !== null && currentMusic.coverPhotoPath !== '' && currentMusic.coverPhotoPath !== undefined && /*#__PURE__*/_jsxDEV(\"img\", {\n              src: currentMusic.coverPhotoPath,\n              alt: \"coverPhoto\",\n              style: {\n                width: \"450px\",\n                height: \"450px\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 473,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 469,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 468,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n          className: \"col-lg-5 col-md-12 p-1 p-lg-5\",\n          id: \"topRight\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-flex flex-column align-items-center\",\n            children: currentMusic !== null && /*#__PURE__*/_jsxDEV(LrcDisplayer, {\n              music: currentMusic,\n              currentTime: currentTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 482,\n              columnNumber: 55\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 481,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row flex-grow-1\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-12\",\n          id: \"upperBottom\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Search\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 490,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Keywords\",\n            style: {\n              color: \"black\",\n              width: \"200px\"\n            },\n            onChange: handleSearchChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 493,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              minHeight: '200px',\n              maxHeight: '400px',\n              maxWidth: '1000px',\n              overflow: 'auto'\n            },\n            children: musicList.map(music => {\n              if (music.audioTitle.toLowerCase().includes(searchKeywords.toLowerCase(), 0) || music.artist.toLowerCase().includes(searchKeywords.toLowerCase(), 0) || music.album.toLowerCase().includes(searchKeywords.toLowerCase(), 0)) {\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    display: \"grid\",\n                    gridTemplateColumns: \"repeat(3, 1fr)\",\n                    gridGap: 20,\n                    color: \"white\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                      style: {\n                        background: \"lightgreen\"\n                      },\n                      onClick: () => {\n                        loadAndPlayMusic(music.audioTitle);\n                      },\n                      children: \"play\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 500,\n                      columnNumber: 49\n                    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                      style: {\n                        background: \"pink\"\n                      },\n                      onClick: () => {\n                        deleteMusic(music.audioTitle);\n                      },\n                      children: \"delete\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 501,\n                      columnNumber: 49\n                    }, this), music.audioTitle]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 499,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: music.artist\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 504,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: music.album\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 505,\n                    columnNumber: 45\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 498,\n                  columnNumber: 41\n                }, this);\n              }\n              return null;\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 494,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"selectMusic\",\n            style: {\n              marginTop: \"20px\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n              children: \"Add music from your computer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 514,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Title\",\n              style: {\n                color: \"black\",\n                width: \"200px\"\n              },\n              onChange: handleTitleChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 517,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Artist\",\n              style: {\n                color: \"black\",\n                width: \"200px\"\n              },\n              onChange: handleArtistChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 518,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              placeholder: \"Album\",\n              style: {\n                color: \"black\",\n                width: \"200px\"\n              },\n              onChange: handleAlbumChange\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 519,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: \"flex\",\n                flexDirection: \"row\",\n                justifyContent: \"space-between\",\n                margin: \"5px\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  style: {\n                    margin: \"4px\"\n                  },\n                  children: \"Cover\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 522,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  id: \"coverFile\",\n                  type: \"file\",\n                  style: {\n                    color: \"grey\"\n                  },\n                  onChange: handleCoverFileChange\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 524,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true), /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  style: {\n                    margin: \"4px\"\n                  },\n                  children: \"Lyrics\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 527,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  id: \"lyricsFile\",\n                  type: \"file\",\n                  style: {\n                    color: \"grey\"\n                  },\n                  onChange: handleLyricsFileChange\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 529,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true), /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  style: {\n                    margin: \"4px\"\n                  },\n                  children: \"Music\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 532,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  id: \"musicFile\",\n                  type: \"file\",\n                  style: {\n                    color: \"grey\"\n                  },\n                  onChange: handleMusicFileChange\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 534,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 520,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              style: {\n                background: \"lightblue\"\n              },\n              onClick: addMusic,\n              children: \"Upload\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 537,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 512,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 489,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        style: {\n          marginTop: \"20px\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-12\",\n          id: \"bottom\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            style: {\n              color: 'white'\n            },\n            children: currentMusic === null ? fileName : currentMusic.audioTitle\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 546,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Artist: \", currentMusic === null ? \"unknown\" : currentMusic.artist]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 547,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"Album: \", currentMusic === null ? \"unknown\" : currentMusic.album]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 548,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handlePlayClick,\n            disabled: isPlayingMusic || !audioData,\n            children: \"Play\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 551,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handlePauseClick,\n            disabled: !isPlayingMusic || !audioSource,\n            children: \"Pause\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 554,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleStopClick,\n            disabled: !audioSource,\n            children: \"Stop\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 557,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"range\",\n            min: \"0\",\n            max: \"1\",\n            step: \"0.01\",\n            value: volumeLevel,\n            onChange: handleVolumeChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 560,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"single\",\n            onClick: () => {\n              setPlayMode('single');\n            },\n            disabled: playMode === 'single',\n            children: \"Single\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 568,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"loop\",\n            onClick: () => {\n              setPlayMode('loop');\n            },\n            disabled: playMode === 'loop',\n            children: \"Loop\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 569,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            id: \"random\",\n            onClick: () => {\n              setPlayMode('random');\n            },\n            disabled: playMode === 'random',\n            children: \"Random\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 570,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"range\",\n              id: \"progressBar\",\n              min: \"0\",\n              max: audioData ? audioData.duration : 0,\n              step: \"0.01\",\n              style: {\n                width: \"300px\",\n                height: \"40px\"\n              },\n              onChange: setProgressBar\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 572,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                color: \"white\"\n              },\n              children: [numberToTime(currentTime), \" / \", numberToTime(duration)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 582,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 571,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 543,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          height: \"250px\"\n        },\n        children: /*#__PURE__*/_jsxDEV(Client, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 587,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 586,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 464,\n    columnNumber: 9\n  }, this);\n}\n_s(AudioPlayer, \"b3AqhtuqfZTrVO0iPnyXmltqENw=\");\n_c = AudioPlayer;\nvar _c;\n$RefreshReg$(_c, \"AudioPlayer\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","DecodeWav","MusicVisualizer","LrcDisplayer","musicList","Client","io","jsxDEV","_jsxDEV","Fragment","_Fragment","AudioPlayer","_s","numberToTime","number","minutes","Math","floor","seconds","minutesString","secondsString","socket","connect","fileName","setFileName","audioBuffer","setAudioBuffer","audioData","setAudioData","audioSource","setAudioSource","isPlayingMusic","setIsPlayingMusic","volumeLevel","setVolumeLevel","audioContext","setAudioContext","analyser","setAnalyser","musicFormat","setMusicFormat","currentTime","setCurrentTime","duration","setDuration","currentMusic","setCurrentMusic","playMode","setPlayMode","searchKeywords","setSearch","handleSearchChange","event","target","value","title","setTitle","handleTitleChange","artist","setArtist","handleArtistChange","album","setAlbum","handleAlbumChange","coverFile","setCoverFile","handleCoverFileChange","file","files","format","name","substr","length","alert","fpath","URL","createObjectURL","lyricsFile","setLyricsFile","handleLyricsFileChange","concat","musicFile","setMusicFile","handleMusicFileChange","updateState","forceUpdate","addMusic","push","deleteMusic","splice","findIndex","obj","audioTitle","loadMusic","audioObj","find","File","fetch","audioPath","then","response","blob","handleStopClick","newAudioContext","AudioContext","toLowerCase","decodedData","createBuffer","numChannels","sampleRate","arrayBuffer","decodedAudioData","decodeAudioData","stop","close","handleFileChange","isMusicExist","map","music","handlePlayClick","console","log","context","state","resume","setOffset","createAnalyser","fftSize","destination","gainNode","createGain","gain","channel","channelData","getChannelData","i","sourceNode","createBufferSource","buffer","start","handlePauseClick","suspend","document","getElementById","handleVolumeChange","parseFloat","disconnect","offset","setProgressBar","progressBar","targetTime","updateProgressBar","time","baseLatency","interval","setInterval","clearInterval","loadAndPlayMusic","decodedAudioBuffer","new2AudioContext","new3AudioContext","handleEnd","randomIndex","random","randomMusic","addEventListener","removeEventListener","id","children","className","class","width","height","_jsxFileName","lineNumber","columnNumber","coverPhotoPath","undefined","src","alt","style","type","placeholder","color","onChange","minHeight","maxHeight","maxWidth","overflow","includes","display","gridTemplateColumns","gridGap","background","onClick","marginTop","flexDirection","justifyContent","margin","disabled","min","max","step","_c","$RefreshReg$"],"sources":["C:/Users/User/OneDrive/文件/GitHub/CSCI3280Project/client/src/AudioScript/AudioPlayer.js"],"sourcesContent":["import React, { useEffect, useState, useCallback } from 'react';\r\nimport { DecodeWav } from './WavDecoder';\r\nimport MusicVisualizer from './MusicVisualizer';\r\nimport LrcDisplayer from './LrcDisplayer';\r\nimport musicList from '../MusicDatabase/musicList';\r\nimport Client from './Client';\r\nimport io from 'socket.io-client';\r\nimport \"../index.css\"\r\n\r\nexport default function AudioPlayer() {\r\n\r\n    const numberToTime = (number) => {\r\n        const minutes = Math.floor(number / 60);\r\n        const seconds = Math.floor(number % 60);\r\n        const minutesString = minutes < 10 ? `0${minutes}` : `${minutes}`;\r\n        const secondsString = seconds < 10 ? `0${seconds}` : `${seconds}`;\r\n        return `${minutesString}:${secondsString}`;\r\n    };\r\n    const socket = io.connect(\"http://localhost:3001\");\r\n    const [fileName, setFileName] = useState(null);\r\n    // const [audioURL, setAudioURL] = useState(null);\r\n    const [audioBuffer, setAudioBuffer] = useState(null);\r\n    const [audioData, setAudioData] = useState(null); // wav audio data\r\n    const [audioSource, setAudioSource] = useState(null); // the audio\r\n    const [isPlayingMusic, setIsPlayingMusic] = useState(false); // is music paying\r\n    const [volumeLevel, setVolumeLevel] = useState(0.5); // music volume level\r\n    const [audioContext, setAudioContext] = useState(null); // holder of the audio and properties\r\n    const [analyser, setAnalyser] = useState(null); // for music visualizer\r\n    const [musicFormat, setMusicFormat] = useState(null); // music format: wav, mp3, null\r\n    const [currentTime, setCurrentTime] = useState(0); // for progress bar\r\n    const [duration, setDuration] = useState(0); // for progress bar\r\n    const [currentMusic, setCurrentMusic] = useState(null); // for database and lyric\r\n    const [playMode, setPlayMode] = useState('single'); // for play mode, single, loop, random\r\n    const [searchKeywords, setSearch] = useState('');\r\n    const handleSearchChange = (event) => {setSearch(event.target.value);};\r\n    const [title, setTitle] = useState('unknown'); // for title\r\n    const handleTitleChange = (event) => {setTitle(event.target.value);};\r\n    const [artist, setArtist] = useState('unknown'); // for artist\r\n    const handleArtistChange = (event) => {setArtist(event.target.value);};\r\n    const [album, setAlbum] = useState('unknown'); // for album\r\n    const handleAlbumChange = (event) => {setAlbum(event.target.value);};\r\n    const [coverFile, setCoverFile] = useState(null); // for cover\r\n    const handleCoverFileChange = (event) => {\r\n        const file = event.target.files[0];\r\n        const format = file.name.substr(file.name.length - 3);\r\n        if (format !== 'jpg' && format !== 'JPG' && format !== 'png' && format !== 'PNG') {\r\n            if (file.name.substr(file.name.length - 4) !== 'jpeg' && file.name.substr(file.name.length - 4) !== 'JPEG') {\r\n                alert('Please upload a jpg or png file');\r\n                return;\r\n            }\r\n        }\r\n        const fpath = URL.createObjectURL(file);\r\n        setCoverFile(fpath);\r\n    };\r\n    const [lyricsFile, setLyricsFile] = useState(null); // for lyrics\r\n    const handleLyricsFileChange = (event) => {\r\n        const file = event.target.files[0];\r\n        const format = file.name.substr(file.name.length - 3);\r\n        if (format !== 'txt' && format !== 'lrc') {\r\n            alert('Please upload a txt or lrc file');\r\n            return;\r\n        }\r\n        var fpath = URL.createObjectURL(file);\r\n\r\n        fpath = fpath.concat(\".\"+format);\r\n\r\n        setLyricsFile(fpath);\r\n    };\r\n    const [musicFile, setMusicFile] = useState(null); // for music file\r\n    const handleMusicFileChange = (event) => {\r\n        const file = event.target.files[0];\r\n        const format = file.name.substr(file.name.length - 3);\r\n        if (format !== 'wav' && format !== 'mp3' && format !== 'ogg' && 'aac') {\r\n            alert('Please upload a wav, mp3, ogg or aac file');\r\n            return;\r\n        }\r\n        const fpath = URL.createObjectURL(file);\r\n        setMusicFile(fpath);\r\n    };\r\n\r\n    const [, updateState] = React.useState();\r\n    const forceUpdate = React.useCallback(() => updateState({}), []); // force rerender\r\n\r\n    // Add music to database\r\n    const addMusic = useCallback (() => {\r\n\r\n        if (musicFile === null) { alert (\"please upload a music\"); return; }\r\n\r\n        if (title === null) { setTitle('unknown'); }\r\n        if (artist === null) { setArtist('unknown'); }\r\n        if (album === null) { setAlbum('unknown'); }\r\n        if (coverFile === null) { setCoverFile(''); }\r\n        if (lyricsFile === null) { setLyricsFile(''); }\r\n        if (musicFile === null) { setMusicFile(''); }\r\n    \r\n        musicList.push(\r\n            {\r\n                \"audioPath\": musicFile,\r\n                \"audioTitle\": title,\r\n                \"artist\": artist,\r\n                \"album\": album,\r\n                \"coverPhotoPath\": coverFile,\r\n                \"lyricsPath\": lyricsFile\r\n            }\r\n        );\r\n\r\n        forceUpdate();\r\n\r\n        setTitle('unknown');\r\n        setArtist('unknown');\r\n        setAlbum('unknown');\r\n        setCoverFile(null);\r\n        setLyricsFile(null);\r\n        setMusicFile(null);\r\n    },[forceUpdate, title, artist, album, coverFile, lyricsFile, musicFile]);\r\n\r\n    // delete music from database\r\n    const deleteMusic = useCallback ((name) => {\r\n        musicList.splice(musicList.findIndex(obj => obj.audioTitle === name), 1);\r\n        forceUpdate();\r\n    },[forceUpdate]);\r\n\r\n\r\n    // Load music from database\r\n    const loadMusic = async (audioTitle) => {\r\n        // Find the object in the JSON data that contains the audioTitle\r\n        const audioObj = musicList.find(obj => obj.audioTitle === audioTitle);\r\n        if (!audioObj) {\r\n            alert(`Audio file not found for title: ${audioTitle}`);\r\n            return;\r\n        }\r\n\r\n        // Create a new File object from the audio path in the object\r\n        const file = new File([await fetch(audioObj.audioPath).then(response => response.blob())], audioObj.audioPath);\r\n        setCurrentMusic(audioObj);\r\n        handleStopClick();\r\n        setFileName(file.name);\r\n        const format = file.name.substr(file.name.length - 3);\r\n        setAudioData(null);\r\n        // setAudioURL(URL.createObjectURL(file));\r\n        const newAudioContext = new AudioContext();\r\n        switch (format.toLowerCase()) {\r\n            case 'wav':\r\n                setMusicFormat('wav');\r\n                const decodedData = await DecodeWav(file);\r\n                setAudioData(decodedData);\r\n                setAudioBuffer(newAudioContext.createBuffer(decodedData.numChannels, decodedData.audioData.length / decodedData.numChannels, decodedData.sampleRate))\r\n                setDuration(decodedData.duration);\r\n                break;\r\n            default:\r\n                setMusicFormat(format.toLowerCase());\r\n                const response = await fetch(URL.createObjectURL(file));\r\n                const arrayBuffer = await response.arrayBuffer();\r\n                const decodedAudioData = await newAudioContext.decodeAudioData(arrayBuffer);\r\n                setAudioData(decodedAudioData);\r\n                setAudioBuffer(decodedAudioData);\r\n                setDuration(decodedAudioData.duration);\r\n                break;\r\n        }\r\n        if (audioSource !== null) {\r\n            audioSource.stop();\r\n        }\r\n        newAudioContext.close();\r\n    };\r\n\r\n    const handleFileChange = async (event) => {\r\n        const file = event.target.files[0];\r\n        const format = file.name.substr(file.name.length - 3);\r\n        if (format !== 'wav' && format !== 'mp3' && format !== 'ogg' && 'aac') {\r\n            alert('Please upload a wav, mp3, ogg or aac file');\r\n            return;\r\n        }\r\n        var isMusicExist = false;\r\n        musicList.map((music) => {\r\n            if (music.audioTitle === file.name.substr(0, file.name.length-4)) {\r\n                isMusicExist = true;\r\n                alert('This music is already in the database');\r\n            }\r\n        })\r\n        const fpath = URL.createObjectURL(file);\r\n        setMusicFile(fpath);\r\n    };\r\n\r\n    // Play Music\r\n    const handlePlayClick = () => {\r\n        if (isPlayingMusic === true) return;\r\n        if (musicFormat === null) return;\r\n\r\n        console.log('play');\r\n        setIsPlayingMusic(true);\r\n        if (audioSource !== null && audioSource.context.state === 'suspended') {\r\n            // resume audio\r\n            audioSource.context.resume();\r\n        }\r\n        else {\r\n            // play a new audio\r\n            setCurrentTime(0);\r\n            setOffset(0);\r\n            let newAudioContext;\r\n            if (audioContext === null) newAudioContext = new AudioContext();\r\n            else newAudioContext = audioContext;\r\n\r\n            // set analyser\r\n            const analyser = newAudioContext.createAnalyser();\r\n            analyser.fftSize = 256;\r\n            analyser.connect(newAudioContext.destination);\r\n            setAnalyser(analyser);\r\n\r\n            // set volume\r\n            const gainNode = newAudioContext.createGain();\r\n            gainNode.gain.value = volumeLevel;\r\n            gainNode.connect(analyser);\r\n\r\n            if (musicFormat === 'wav') {\r\n                for (let channel = 0; channel < audioData.numChannels; channel++) {\r\n                    const channelData = audioBuffer.getChannelData(channel);\r\n                    for (let i = 0; i < audioData.audioData.length; i += audioData.numChannels) {\r\n                        channelData[i / audioData.numChannels] = audioData.audioData[i + channel];\r\n                    }\r\n                }\r\n            }\r\n            const sourceNode = newAudioContext.createBufferSource();\r\n            sourceNode.buffer = audioBuffer;\r\n            sourceNode.connect(gainNode);\r\n            sourceNode.start();\r\n            setAudioSource(sourceNode);\r\n            setAudioContext(newAudioContext);\r\n        }\r\n    };\r\n\r\n\r\n    // Pause Music\r\n    const handlePauseClick = () => {\r\n        setIsPlayingMusic(false);\r\n        if (audioSource !== null && audioSource.context.state === 'running') {\r\n            audioSource.context.suspend();\r\n        }\r\n    };\r\n\r\n\r\n    // Stop Music\r\n    const handleStopClick = () => {\r\n        setIsPlayingMusic(false);\r\n        if (audioSource !== null) {\r\n            audioSource.stop();\r\n            setAudioSource(null);\r\n        }\r\n        if (audioContext !== null) {\r\n            audioContext.close();\r\n            setAudioContext(null);\r\n        }\r\n        setOffset(0);\r\n        document.getElementById('progressBar').value = 0;\r\n        setCurrentTime(0);\r\n    };\r\n\r\n\r\n    // Volume Control\r\n    const handleVolumeChange = (event) => {\r\n        setVolumeLevel(parseFloat(event.target.value));\r\n        if (audioSource !== null) {\r\n            const gainNode = audioContext.createGain();\r\n            // console.log('volumeLevel: ', volumeLevel);\r\n            gainNode.gain.value = volumeLevel;\r\n            gainNode.connect(analyser);\r\n            audioSource.disconnect();\r\n            audioSource.connect(gainNode);\r\n        }\r\n    };\r\n\r\n    // Progress Bar\r\n    const [offset, setOffset] = useState(0);\r\n    const setProgressBar = () => {\r\n        if (audioSource === null) return;\r\n        const progressBar = document.getElementById('progressBar');\r\n        let targetTime = progressBar.value;\r\n        setOffset(targetTime);\r\n\r\n        if (audioSource !== null) {\r\n            audioSource.stop();\r\n            setAudioSource(null);\r\n        }\r\n\r\n        let newAudioContext;\r\n        if (audioContext !== null) {\r\n            audioContext.close();\r\n            setAudioContext(null);\r\n            newAudioContext = new AudioContext();\r\n        }\r\n        else newAudioContext = audioContext;\r\n\r\n        // set analyser\r\n        const analyser = newAudioContext.createAnalyser();\r\n        analyser.fftSize = 256;\r\n        analyser.connect(newAudioContext.destination);\r\n        setAnalyser(analyser);\r\n\r\n        // set volume\r\n        const gainNode = newAudioContext.createGain();\r\n        gainNode.gain.value = volumeLevel;\r\n        gainNode.connect(analyser);\r\n\r\n        if (musicFormat === 'wav')\r\n            for (let channel = 0; channel < audioData.numChannels; channel++) {\r\n                const channelData = audioBuffer.getChannelData(channel);\r\n                for (let i = 0; i < audioData.audioData.length; i += audioData.numChannels) {\r\n                    channelData[i / audioData.numChannels] = audioData.audioData[i + channel];\r\n                }\r\n            }\r\n        const sourceNode = newAudioContext.createBufferSource();\r\n        sourceNode.buffer = audioBuffer;\r\n        sourceNode.connect(gainNode);\r\n        sourceNode.start(0, targetTime);\r\n        setAudioSource(sourceNode);\r\n        setAudioContext(newAudioContext);\r\n\r\n        if (!isPlayingMusic) {\r\n            sourceNode.context.suspend();\r\n        }\r\n        updateProgressBar();\r\n    }\r\n\r\n    const updateProgressBar = useCallback(() => {\r\n        const progressBar = document.getElementById('progressBar');\r\n        let duration = audioData ? audioData.duration : 0;\r\n        let time = audioContext.currentTime - audioSource.context.baseLatency + parseFloat(offset);\r\n        if (time > duration) {\r\n            time = duration;\r\n        }\r\n        progressBar.value = time;\r\n        setCurrentTime(time);\r\n    }, [audioContext, audioData, audioSource, offset]);\r\n\r\n    useEffect(() => {\r\n        if (isPlayingMusic) {\r\n            const interval = setInterval(updateProgressBar, 10);\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [isPlayingMusic, updateProgressBar]);\r\n\r\n    // Load and Play\r\n    const loadAndPlayMusic = async (audioTitle) => {\r\n\r\n        // Find the object in the JSON data that contains the audioTitle\r\n        const audioObj = musicList.find(obj => obj.audioTitle === audioTitle);\r\n        if (!audioObj) {\r\n            alert(`Audio file not found for title: ${audioTitle}`);\r\n            return;\r\n        }\r\n\r\n        // Create a new File object from the audio path in the object\r\n        const file = new File([await fetch(audioObj.audioPath).then(response => response.blob())], audioObj.audioPath);\r\n        setCurrentMusic(audioObj);\r\n        if (audioSource !== null) {\r\n            audioSource.stop();\r\n            setAudioSource(null);\r\n        }\r\n        if (audioContext !== null) {\r\n            audioContext.close();\r\n            setAudioContext(null);\r\n        }\r\n        setOffset(0);\r\n        document.getElementById('progressBar').value = 0;\r\n        setCurrentTime(0);\r\n        setFileName(file.name);\r\n        const format = file.name.substr(file.name.length - 3);\r\n        let decodedAudioData;\r\n        let decodedAudioBuffer;\r\n        setAudioData(null);\r\n        // setAudioURL(URL.createObjectURL(file));\r\n        const new2AudioContext = new AudioContext();\r\n        switch (format.toLowerCase()) {\r\n            case 'wav':\r\n                setMusicFormat('wav');\r\n                decodedAudioData = await DecodeWav(file);\r\n                setAudioData(decodedAudioData);\r\n                decodedAudioBuffer = (new2AudioContext.createBuffer(decodedAudioData.numChannels, decodedAudioData.audioData.length / decodedAudioData.numChannels, decodedAudioData.sampleRate))\r\n                setAudioBuffer(decodedAudioBuffer);\r\n                setDuration(decodedAudioData.duration);\r\n                break;\r\n            default:\r\n                setMusicFormat(format.toLowerCase());\r\n                const response = await fetch(URL.createObjectURL(file));\r\n                const arrayBuffer = await response.arrayBuffer();\r\n                decodedAudioData = await new2AudioContext.decodeAudioData(arrayBuffer);\r\n                setAudioData(decodedAudioData);\r\n                decodedAudioBuffer = (decodedAudioData);\r\n                setAudioBuffer(decodedAudioBuffer);\r\n                setDuration(decodedAudioData.duration);\r\n                break;\r\n        }\r\n        if (audioSource !== null) {\r\n            audioSource.stop();\r\n        }\r\n        new2AudioContext.close();\r\n\r\n        setIsPlayingMusic(true);\r\n\r\n        // play a new audio\r\n        setCurrentTime(0);\r\n        setOffset(0);\r\n        let new3AudioContext;\r\n        if (audioContext === null || audioContext.state === \"closed\") new3AudioContext = new AudioContext();\r\n        else new3AudioContext = audioContext;\r\n\r\n        // set analyser\r\n        const analyser = new3AudioContext.createAnalyser();\r\n        analyser.fftSize = 256;\r\n        analyser.connect(new3AudioContext.destination);\r\n        setAnalyser(analyser);\r\n\r\n        // set volume\r\n        const gainNode = new3AudioContext.createGain();\r\n        gainNode.gain.value = volumeLevel;\r\n        gainNode.connect(analyser);\r\n\r\n        if (musicFormat === 'wav') {\r\n            for (let channel = 0; channel < decodedAudioData.numChannels; channel++) {\r\n                const channelData = decodedAudioBuffer.getChannelData(channel);\r\n                for (let i = 0; i < decodedAudioData.decodedAudioData.length; i += decodedAudioData.numChannels) {\r\n                    channelData[i / decodedAudioData.numChannels] = decodedAudioData.decodedAudioData[i + channel];\r\n                }\r\n            }\r\n        }\r\n        const sourceNode = new3AudioContext.createBufferSource();\r\n        sourceNode.buffer = decodedAudioBuffer;\r\n        sourceNode.connect(gainNode);\r\n        sourceNode.start();\r\n        setAudioSource(sourceNode);\r\n        setAudioContext(new3AudioContext);\r\n    };\r\n\r\n    // handle PlayMode\r\n    useEffect(() => {\r\n        if (audioContext === null) return;\r\n        const handleEnd = () => {\r\n            setIsPlayingMusic(false);\r\n            setCurrentTime(0);\r\n\r\n            switch (playMode) {\r\n                case 'single':\r\n                    audioSource.stop();\r\n                    break;\r\n                case 'loop':\r\n                    loadAndPlayMusic(currentMusic.audioTitle);\r\n                    break;\r\n                case 'random':\r\n                    const randomIndex = Math.floor(Math.random() * musicList.length);\r\n                    const randomMusic = musicList[randomIndex];\r\n                    loadAndPlayMusic(randomMusic.audioTitle);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        };\r\n\r\n        audioSource.addEventListener('ended', handleEnd);\r\n        return () => audioSource.removeEventListener('ended', handleEnd);\r\n    }, [audioContext, audioData, audioSource, currentMusic, musicFormat, playMode, volumeLevel]);\r\n\r\n\r\n\r\n    return (\r\n        <div id=\"audioPlayer\">\r\n            <div className=\"container\">\r\n                <div className=\"row align-items-center\">\r\n                    {/* Top left block: Cover photo and visualizer. */}\r\n                    <section className=\" col-lg-7 col-md-12 p-1 p-lg-5\" id='topLeft'>\r\n                        <div className=\"d-flex flex-column align-items-center\">\r\n                            <MusicVisualizer class=\"mx-auto d-block\" audioContext={audioContext} analyser={analyser} width={450} height={50} />\r\n\r\n                            {currentMusic !== null && currentMusic.coverPhotoPath !== '' && currentMusic.coverPhotoPath !== undefined &&\r\n                                <img src={currentMusic.coverPhotoPath} alt=\"coverPhoto\" style={{ width: \"450px\", height: \"450px\" }}></img>\r\n                            }\r\n                        </div>\r\n                    </section>\r\n\r\n\r\n                    {/* Top right block: Lyrics. */}\r\n                    <section className=\"col-lg-5 col-md-12 p-1 p-lg-5\" id='topRight'>\r\n                        <div className=\"d-flex flex-column align-items-center\">\r\n                            {currentMusic !== null && <LrcDisplayer music={currentMusic} currentTime={currentTime} />}\r\n                        </div>\r\n                    </section>\r\n                </div>\r\n\r\n                <div className=\"row flex-grow-1\">\r\n                    {/* Upper bottom: Song list and uploding. */}\r\n                    <div className=\"col-md-12\" id='upperBottom'>\r\n                            <h3> \r\n                                Search\r\n                            </h3>\r\n                            <input type=\"text\" placeholder=\"Keywords\" style={{color:\"black\", width: \"200px\"}} onChange={handleSearchChange} />\r\n                        <div style={{ minHeight: '200px', maxHeight: '400px', maxWidth: '1000px', overflow: 'auto' }}>\r\n                            {musicList.map((music) => {\r\n                                if (music.audioTitle.toLowerCase().includes(searchKeywords.toLowerCase(), 0) || music.artist.toLowerCase().includes(searchKeywords.toLowerCase(), 0) || music.album.toLowerCase().includes(searchKeywords.toLowerCase(), 0)) {\r\n                                    return (\r\n                                        <div style={{ display: \"grid\", gridTemplateColumns: \"repeat(3, 1fr)\", gridGap: 20, color: \"white\" }}>\r\n                                            <div>\r\n                                                <button style={{background: \"lightgreen\"}} onClick={() => { loadAndPlayMusic(music.audioTitle) }}>play</button>\r\n                                                <button style={{background: \"pink\"}} onClick={() => { deleteMusic(music.audioTitle) }}>delete</button>\r\n                                                {music.audioTitle}\r\n                                            </div>\r\n                                            <div>{music.artist}</div>\r\n                                            <div>{music.album}</div>\r\n                                        </div>\r\n                                    );\r\n                                }\r\n                                return null;\r\n                            })}\r\n                        </div>\r\n                        <div id=\"selectMusic\" style={{marginTop: \"20px\"}}>\r\n                        \r\n                            <h3>\r\n                                Add music from your computer \r\n                            </h3>\r\n                            <input type=\"text\" placeholder=\"Title\" style={{color:\"black\", width: \"200px\"}} onChange={handleTitleChange} />\r\n                            <input type=\"text\" placeholder=\"Artist\" style={{color:\"black\", width: \"200px\"}} onChange={handleArtistChange}/>\r\n                            <input type=\"text\" placeholder=\"Album\" style={{color:\"black\", width: \"200px\"}} onChange={handleAlbumChange}/>\r\n                            <div style={{display:\"flex\", flexDirection:\"row\", justifyContent:\"space-between\", margin:\"5px\"}}>\r\n                                <>\r\n                                    <p style={{margin: \"4px\"}}>Cover</p>\r\n                                    {/* <label for=\"coverFile\" style={{background:\"white\", marginLeft:\"5px\", marginRight:\"5px\"}}>Select Cover</label> */}\r\n                                    <input id=\"coverFile\" type=\"file\" style={{color:\"grey\"}} onChange={handleCoverFileChange} />\r\n                                </>\r\n                                <>\r\n                                    <p style={{margin: \"4px\"}}>Lyrics</p>\r\n                                    {/* <label for=\"lyricsFile\" style={{background:\"white\", marginLeft:\"5px\", marginRight:\"5px\"}}>Select Lyrics</label> */}\r\n                                    <input id=\"lyricsFile\" type=\"file\" style={{color:\"grey\"}} onChange={handleLyricsFileChange} />\r\n                                </>\r\n                                <>\r\n                                    <p style={{margin: \"4px\"}}>Music</p>\r\n                                    {/* <label for=\"musicFile\" style={{background:\"white\", marginLeft:\"5px\", marginRight:\"5px\"}}>Select Music</label> */}\r\n                                    <input id=\"musicFile\" type=\"file\" style={{color:\"grey\"}} onChange={handleMusicFileChange} />\r\n                                </>\r\n                            </div>\r\n                            <button style={{background:\"lightblue\"}} onClick={addMusic}>Upload</button>\r\n                        </div>\r\n\r\n                    </div>\r\n                </div>\r\n                \r\n                <div className=\"row\" style={{marginTop:\"20px\"}}>\r\n                    {/* Bottom block: Audio information and control. */}\r\n                    <div className=\"col-md-12\" id='bottom'>\r\n                        <h2 style={{color: 'white'}}>{currentMusic === null ? fileName : currentMusic.audioTitle}</h2>\r\n                        <p>Artist: {currentMusic === null ? \"unknown\" : currentMusic.artist}</p>\r\n                        <p>Album: {currentMusic === null ? \"unknown\" : currentMusic.album}</p>\r\n\r\n\r\n                        <button onClick={handlePlayClick} disabled={isPlayingMusic || (!audioData)}>\r\n                            Play\r\n                        </button>\r\n                        <button onClick={handlePauseClick} disabled={!isPlayingMusic || (!audioSource)}>\r\n                            Pause\r\n                        </button>\r\n                        <button onClick={handleStopClick} disabled={(!audioSource)}>\r\n                            Stop\r\n                        </button>\r\n                        <input\r\n                            type=\"range\"\r\n                            min=\"0\"\r\n                            max=\"1\"\r\n                            step=\"0.01\"\r\n                            value={volumeLevel}\r\n                            onChange={handleVolumeChange}\r\n                        />\r\n                        <button id=\"single\" onClick={() => { setPlayMode('single') }} disabled={playMode === 'single'}>Single</button>\r\n                        <button id=\"loop\" onClick={() => { setPlayMode('loop') }} disabled={playMode === 'loop'}>Loop</button>\r\n                        <button id=\"random\" onClick={() => { setPlayMode('random') }} disabled={playMode === 'random'}>Random</button>\r\n                        <div>\r\n                            <input\r\n                                type=\"range\"\r\n                                id=\"progressBar\"\r\n                                min=\"0\"\r\n                                max={audioData ? audioData.duration : 0}\r\n                                step=\"0.01\"\r\n                                style={{ width: \"300px\", height:\"40px\" }}\r\n                                onChange={setProgressBar}\r\n                            >\r\n                            </input>\r\n                            <p style={{color:\"white\"}}>{numberToTime(currentTime)} / {numberToTime(duration)}</p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div style={{height:\"250px\"}}>\r\n                    <Client/>\r\n                </div>\r\n            </div>\r\n            \r\n\r\n\r\n\r\n\r\n\r\n            {/* Debug: Audio data. */}\r\n            {/* {\r\n                audioData && (\r\n                    <div>\r\n                        <p>File Name: {fileName}</p>\r\n                        <p>File Format: {musicFormat}</p>\r\n                        <p>Audio Format: {audioData.format}</p>\r\n                        <p>Number of Channels: {audioData.numChannels}</p>\r\n                        <p>Sample Rate: {audioData.sampleRate}</p>\r\n                        <p>Byte Rate: {audioData.byteRate}</p>\r\n                        <p>Block Align: {audioData.blockAlign}</p>\r\n                        <p>Bit Depth: {audioData.bitDepth}</p>\r\n                    </div>\r\n                )\r\n            } */}\r\n        </div >\r\n    );\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}